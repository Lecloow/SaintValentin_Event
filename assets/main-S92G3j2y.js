import{S as i}from"./storage-BBbnFWtQ.js";const l="https://saint-valentin-backend.onrender.com";class a{static async login(s){try{const t=await fetch(`${l}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const n=await t.text();throw{status:t.status,message:n||`Erreur ${t.status}`}}return await t.json()}catch(t){throw t instanceof Error?{status:0,message:t.message}:t}}}class o{constructor(){this.form=null,this.passwordInput=null,this.resultEl=null,this.submitBtn=null,this.init()}init(){this.cacheElements(),this.attachEventListeners()}cacheElements(){this.form=document.getElementById("loginForm"),this.passwordInput=document.getElementById("password"),this.resultEl=document.getElementById("result"),this.submitBtn=document.getElementById("submitBtn"),(!this.form||!this.passwordInput||!this.resultEl)&&console.error("Elements manquants dans le DOM")}attachEventListeners(){var s,t;(s=this.form)==null||s.addEventListener("submit",e=>this.handleSubmit(e)),(t=this.passwordInput)==null||t.addEventListener("input",()=>this.clearError())}async handleSubmit(s){var e;s.preventDefault();const t=(e=this.passwordInput)==null?void 0:e.value.trim();if(!t){this.showError("Veuillez entrer un code.");return}await this.submitLogin(t)}async submitLogin(s){try{this.setLoading(!0),this.clearError();const t={password:s},e=await a.login(t);i.setUser(e),this.showSuccess("Connexion r√©ussie! Redirection..."),window.location.href="./profile.html"}catch(t){const e=t.message||"Erreur lors de la connexion";this.showError(e)}finally{this.setLoading(!1)}}showError(s){this.resultEl&&(this.resultEl.textContent=s,this.resultEl.className="result error")}showSuccess(s){this.resultEl&&(this.resultEl.textContent=s,this.resultEl.className="result success")}setLoading(s){!this.submitBtn||!this.resultEl||(this.submitBtn.disabled=s,s?(this.resultEl.innerHTML='<span class="spinner"></span>Connexion en cours...',this.resultEl.className="result loading"):(this.resultEl.innerHTML="",this.resultEl.className="result"))}clearError(){this.resultEl&&(this.resultEl.innerHTML="",this.resultEl.className="result")}}document.addEventListener("DOMContentLoaded",()=>{new o});
