(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const a="http://localhost:8000";class u{static async login(t){try{const e=await fetch(`${a}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const s=await e.text();throw{status:e.status,message:s||`Erreur ${e.status}`}}return await e.json()}catch(e){throw e instanceof Error?{status:0,message:e.message}:e}}}const l="user";class c{static setUser(t){sessionStorage.setItem(l,JSON.stringify(t))}static getUser(){const t=sessionStorage.getItem(l);if(!t)return null;try{return JSON.parse(t)}catch{return this.clearUser(),null}}static clearUser(){sessionStorage.removeItem(l)}static isLoggedIn(){return this.getUser()!==null}}class h{constructor(){this.form=null,this.passwordInput=null,this.resultEl=null,this.submitBtn=null,this.init()}init(){this.cacheElements(),this.attachEventListeners()}cacheElements(){this.form=document.getElementById("loginForm"),this.passwordInput=document.getElementById("password"),this.resultEl=document.getElementById("result"),this.submitBtn=document.getElementById("submitBtn"),(!this.form||!this.passwordInput||!this.resultEl)&&console.error("Elements manquants dans le DOM")}attachEventListeners(){var t,e;(t=this.form)==null||t.addEventListener("submit",r=>this.handleSubmit(r)),(e=this.passwordInput)==null||e.addEventListener("input",()=>this.clearError())}async handleSubmit(t){var r;t.preventDefault();const e=(r=this.passwordInput)==null?void 0:r.value.trim();if(!e){this.showError("Veuillez entrer un code.");return}await this.submitLogin(e)}async submitLogin(t){try{this.setLoading(!0),this.clearError();const e={password:t},r=await u.login(e);c.setUser(r),this.showSuccess("Connexion rÃ©ussie! Redirection..."),setTimeout(()=>{window.location.href="./profile.html"},1e3)}catch(e){const r=e.message||"Erreur lors de la connexion";this.showError(r)}finally{this.setLoading(!1)}}showError(t){this.resultEl&&(this.resultEl.textContent=t,this.resultEl.className="result error")}showSuccess(t){this.resultEl&&(this.resultEl.textContent=t,this.resultEl.className="result success")}setLoading(t){!this.submitBtn||!this.resultEl||(this.submitBtn.disabled=t,t?(this.resultEl.innerHTML='<span class="spinner"></span>Connexion en cours...',this.resultEl.className="result loading"):(this.resultEl.innerHTML="",this.resultEl.className="result"))}clearError(){this.resultEl&&(this.resultEl.innerHTML="",this.resultEl.className="result")}}document.addEventListener("DOMContentLoaded",()=>{new h});
